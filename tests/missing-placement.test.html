<html>
  <body>
    <div data-ea-publisher="test" data-ea-manual="true"></div>

    <script type="module">
      import { expect } from "@open-wc/testing";
      import { runTests } from "@web/test-runner-mocha";
      import { default as sinon } from "sinon";

      import { wait, load_placements, Placement } from "../index";

      // Don't actually call the server
      // https://sinonjs.org/releases/v17/stubs/
      let stub = sinon.stub(Placement.prototype, "fetch");
      const response_html =
        "<div><!-- A real ad would be here normally --></div>";
      const elem_placement = document.createElement("div");
      elem_placement.innerHTML = response_html;
      stub.resolves(elem_placement.firstChild);

      runTests(async () => {
        describe("EthicalAds library", () => {
          it("skips manual placements", async () => {
            const placements = await wait;
            expect(placements).to.be.an("array").that.includes(null);
          });
          it("can force load manual placements", async () => {
            const placements = await load_placements(true);
            expect(placements).to.be.an("array");
            expect(placements[0]).to.have.property("publisher", "test");
          });
        });
      });
    </script>
  </body>
</html>
